<h1>Заказы</h1>
@if (filterForm) {
  <form [formGroup]="filterForm">
    <p-floatlabel variant="on">
      <p-select
        [options]="statuses"
        optionLabel="name"
        formControlName="status"
        id="status"
        style="width: 200px"
        optionValue="code"
      />
      <label for="status">Статус</label>
    </p-floatlabel>
    <p-floatlabel variant="on">
      <input pInputText type="text" formControlName="customerName" id="customerName" />
      <label for="customerName">Клиент</label>
    </p-floatlabel>
    <p-button
      label="Найти"
      (onClick)="getList()"
      severity="info"
      [disabled]="!filterForm.dirty"
    ></p-button>
    <p-button label="Сбросить" (onClick)="reset()" severity="secondary"></p-button>
    <p-button label="Создать" (onClick)="create()"></p-button>
    <p-button label="Выйти" (onClick)="logout()" severity="warn"></p-button>
  </form>
}
<p-table
  showGridlines
  stripedRows
  [value]="orders()"
  [lazy]="true"
  [paginator]="true"
  [rows]="pageSize"
  [totalRecords]="totalSize"
  [rowsPerPageOptions]="[5, 10, 20]"
  (onPage)="pageChange($event)"
>
  <ng-template pTemplate="header">
    <tr>
      <th>№</th>
      <th>Номер</th>
      <th>Клиент</th>
      <th>Статус</th>
      <th>Вещи</th>
      <th>Итого</th>
      <th>Дата</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-order let-rowIndex="rowIndex">
    <tr (click)="openInfo(order.id)" style="cursor: pointer">
      <td>{{ rowIndex + 1 }}</td>
      <td>{{ order.number }}</td>
      <td>{{ order.customerName }}</td>
      <td>{{ order.status === 'new' ? 'Новый' : 'В процессе' }}</td>
      <td style="display: flex; flex-direction: column; gap: 5px">
        @for (item of order.items; track item.productId) {
          <p>{{ getProductTitle(item.productId) }} {{ item.qty }} шт - по {{ item.price }} тг</p>
        }
      </td>
      <td>{{ order.total }} тг</td>
      <td>{{ order.createdAt | date: 'MM.dd.yyyy HH:mm' }}</td>
    </tr>
  </ng-template>
</p-table>
